"use strict";(()=>{var e={};e.id=992,e.ids=[992],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},71568:e=>{e.exports=require("zlib")},46249:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>g,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>u,POST:()=>l,dynamic:()=>d});var a=r(49303),s=r(88716),i=r(60670),o=r(83493),c=r(87070);let d="force-dynamic";async function u(e){try{let t=e.headers.get("x-user-id"),r=e.headers.get("x-user-role"),n={};"admin"!==r&&(n={vehicleId:{in:(await o._.vehicle.findMany({where:{ownerId:t||void 0},select:{id:!0}})).map(e=>e.id)}});let a=await o._.maintenance.findMany({where:n,include:{vehicle:{select:{id:!0,licensePlate:!0,brand:!0,model:!0,ownerId:!0}}},orderBy:{maintenanceDate:"desc"}});return c.NextResponse.json({success:!0,maintenances:a})}catch(e){return console.error("Error fetching maintenances:",e),c.NextResponse.json({success:!1,error:"Failed to fetch maintenances"},{status:500})}}async function l(e){try{let t=e.headers.get("x-user-id"),r=e.headers.get("x-user-role"),n=await e.json();if("admin"!==r){let e=await o._.vehicle.findUnique({where:{id:n.vehicleId},select:{ownerId:!0}});if(!e||e.ownerId!==t)return c.NextResponse.json({success:!1,error:"You do not have permission to add maintenance to this vehicle"},{status:403})}let a=await o._.maintenance.create({data:{vehicleId:n.vehicleId,type:n.type,description:n.description,cost:void 0!==n.cost&&null!==n.cost&&""!==n.cost?"number"==typeof n.cost?n.cost:parseFloat(n.cost):null,mileage:n.mileage?parseInt(n.mileage):null,maintenanceDate:new Date(n.maintenanceDate),nextServiceDate:n.nextServiceDate?new Date(n.nextServiceDate):null,workshop:n.workshop,technician:n.technician,notes:n.notes,status:n.status||"pending"}});return c.NextResponse.json({success:!0,maintenance:a})}catch(e){return console.error("Error creating maintenance:",e),c.NextResponse.json({success:!1,error:"Failed to create maintenance record"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/maintenances/route",pathname:"/api/maintenances",filename:"route",bundlePath:"app/api/maintenances/route"},resolvedPagePath:"D:\\kendaraan\\app\\api\\maintenances\\route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:x}=p,v="/api/maintenances/route";function g(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},83493:(e,t,r)=>{r.d(t,{_:()=>d});let n=require("@prisma/client");var a=r(2351);let s=globalThis,i=process.env.DATABASE_URL;i||console.error("âŒ DATABASE_URL environment variable is not set!");let o=i?.replace("mysql://","mariadb://")?.replace(":@","@"),c=o?new a.N(o):void 0,d=s.prisma??new n.PrismaClient({adapter:c,log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,351],()=>r(46249));module.exports=n})();