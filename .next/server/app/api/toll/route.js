"use strict";(()=>{var e={};e.id=737,e.ids=[737],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},76162:e=>{e.exports=require("stream")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},71568:e=>{e.exports=require("zlib")},12968:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>q,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>R,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{DELETE:()=>x,GET:()=>d,POST:()=>u,PUT:()=>p,dynamic:()=>l});var o=t(49303),a=t(88716),n=t(60670),i=t(83493),c=t(87070);let l="force-dynamic";async function d(e){try{let r=e.headers.get("x-user-id"),t=e.headers.get("x-user-role"),s=await i._.tollRecord.findMany({where:"admin"===t?{}:{vehicle:{ownerId:r||void 0}},include:{vehicle:{select:{id:!0,licensePlate:!0,brand:!0,model:!0}}},orderBy:{date:"desc"},take:50});return c.NextResponse.json({success:!0,records:s})}catch(e){return console.error("Error fetching toll records:",e),c.NextResponse.json({success:!1,error:"Failed to fetch toll records"},{status:500})}}async function u(e){try{let r=await e.json();if(!r.vehicleId||!r.date||!r.cost)return c.NextResponse.json({success:!1,error:"Please provide all required fields"},{status:400});let t=await i._.tollRecord.create({data:{vehicleId:r.vehicleId,date:new Date(r.date+"T12:00:00"),driver:r.driver,cost:parseFloat(r.cost),remarks:r.remarks,receiptUrl:r.receiptUrl}});return c.NextResponse.json({success:!0,record:t})}catch(e){return console.error("Error creating toll record:",e),c.NextResponse.json({success:!1,error:"Failed to create record"},{status:500})}}async function p(e){try{let r=await e.json();if(!r.id)return c.NextResponse.json({success:!1,error:"Record ID is required"},{status:400});let t=await i._.tollRecord.update({where:{id:r.id},data:{date:new Date(r.date+"T12:00:00"),driver:r.driver,cost:parseFloat(r.cost),remarks:r.remarks}});return c.NextResponse.json({success:!0,record:t})}catch(e){return console.error("Error updating toll record:",e),c.NextResponse.json({success:!1,error:"Failed to update record"},{status:500})}}async function x(e){try{let{searchParams:r}=new URL(e.url),t=r.get("id");if(!t)return c.NextResponse.json({success:!1,error:"Record ID is required"},{status:400});return await i._.tollRecord.delete({where:{id:t}}),c.NextResponse.json({success:!0,message:"Record deleted"})}catch(e){return console.error("Error deleting toll record:",e),c.NextResponse.json({success:!1,error:"Failed to delete record"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/toll/route",pathname:"/api/toll",filename:"route",bundlePath:"app/api/toll/route"},resolvedPagePath:"D:\\kendaraan\\app\\api\\toll\\route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:h,serverHooks:R}=m,f="/api/toll/route";function q(){return(0,n.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:h})}},83493:(e,r,t)=>{t.d(r,{_:()=>l});let s=require("@prisma/client");var o=t(2351);let a=globalThis,n=process.env.DATABASE_URL;n||console.error("âŒ DATABASE_URL environment variable is not set!");let i=n?.replace("mysql://","mariadb://")?.replace(":@","@"),c=i?new o.N(i):void 0,l=a.prisma??new s.PrismaClient({adapter:c,log:["error"]})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,351],()=>t(12968));module.exports=s})();