"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{28033:function(e,t,a){a.d(t,{AuthGuard:function(){return o},a:function(){return l}});var s=a(57437),r=a(2265),n=a(99376);let i=(0,r.createContext)(null);function o(e){let{children:t,requiredRoles:a}=e,[o,l]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null),f=(0,n.useRouter)(),m=(0,r.useCallback)(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include",cache:"no-store"});if(!e.ok){if(401===e.status&&(await fetch("/api/auth/refresh",{method:"POST",credentials:"include"})).ok){let e=await fetch("/api/auth/me",{credentials:"include"});if(e.ok){let t=await e.json();if(h(t.user),l(!0),a&&!a.includes(t.user.role)){f.push("/dashboard");return}c(!1);return}}f.push("/");return}let t=await e.json();if(t.authenticated&&t.user){if(h(t.user),l(!0),a&&!a.includes(t.user.role)){f.push("/dashboard");return}}else f.push("/")}catch(e){console.error("Auth check error:",e),f.push("/")}finally{c(!1)}},[f,a]),x=(0,r.useCallback)(async()=>{try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout error:",e)}finally{f.push("/")}},[f]);return((0,r.useEffect)(()=>{let e;if(!o)return;let t=()=>{e&&clearTimeout(e),e=setTimeout(()=>{console.log("Session expired due to inactivity"),x()},72e5)},a=["mousedown","mousemove","keydown","scroll","touchstart","click"];return a.forEach(e=>{document.addEventListener(e,t)}),t(),()=>{e&&clearTimeout(e),a.forEach(e=>{document.removeEventListener(e,t)})}},[o,x,72e5]),(0,r.useEffect)(()=>{m()},[m]),d)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"Memuat..."})]})}):o?(0,s.jsx)(i.Provider,{value:{user:u,loading:d,isAdmin:(null==u?void 0:u.role)==="admin",isAuthenticated:o,refetch:m},children:t}):null}function l(){let e=(0,r.useContext)(i),[t,a]=(0,r.useState)(null),[s,n]=(0,r.useState)(!e);return((0,r.useEffect)(()=>{e||t();async function t(){try{let e=await fetch("/api/auth/me",{credentials:"include",cache:"no-store"});if(e.ok){let t=await e.json();a(t.user)}}catch(e){console.error("Error fetching user:",e)}finally{n(!1)}}},[e]),e)?e:{user:t,loading:s,isAdmin:(null==t?void 0:t.role)==="admin",isAuthenticated:!!t,refetch:async()=>{}}}},64715:function(e,t,a){a.d(t,{DashboardLayout:function(){return L}});var s=a(57437),r=a(2265),n=a(99376),i=a(62869),o=a(49027),l=a(32489),d=a(94508);function c(e){let{...t}=e;return(0,s.jsx)(o.fC,{"data-slot":"sheet",...t})}function u(e){let{...t}=e;return(0,s.jsx)(o.xz,{"data-slot":"sheet-trigger",...t})}function h(e){let{...t}=e;return(0,s.jsx)(o.h_,{"data-slot":"sheet-portal",...t})}function f(e){let{className:t,...a}=e;return(0,s.jsx)(o.aV,{"data-slot":"sheet-overlay",className:(0,d.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function m(e){let{className:t,children:a,side:r="right",...n}=e;return(0,s.jsxs)(h,{children:[(0,s.jsx)(f,{}),(0,s.jsxs)(o.VY,{"data-slot":"sheet-content",className:(0,d.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===r&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===r&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===r&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===r&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",t),...n,children:[a,(0,s.jsxs)(o.x8,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,s.jsx)(l.Z,{className:"size-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}var x=a(70085);function g(e){let{...t}=e;return(0,s.jsx)(x.fC,{"data-slot":"dropdown-menu",...t})}function p(e){let{...t}=e;return(0,s.jsx)(x.xz,{"data-slot":"dropdown-menu-trigger",...t})}function v(e){let{className:t,sideOffset:a=4,...r}=e;return(0,s.jsx)(x.Uv,{children:(0,s.jsx)(x.VY,{"data-slot":"dropdown-menu-content",sideOffset:a,className:(0,d.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...r})})}function b(e){let{className:t,inset:a,variant:r="default",...n}=e;return(0,s.jsx)(x.ck,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":r,className:(0,d.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...n})}var j=a(70650);let w=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(j.fC,{ref:t,"data-slot":"avatar",className:(0,d.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",a),...r})});w.displayName=j.fC.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(j.Ee,{ref:t,"data-slot":"avatar-image",className:(0,d.cn)("aspect-square size-full",a),...r})}).displayName=j.Ee.displayName;let y=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(j.NY,{ref:t,"data-slot":"avatar-fallback",className:(0,d.cn)("bg-muted flex size-full items-center justify-center rounded-full",a),...r})});y.displayName=j.NY.displayName;var N=a(14938),k=a(57662),z=a(29525),C=a(71621),S=a(96215),_=a(58293),E=a(47692),Z=a(28033);let A=[{name:"Dashboard",href:"/dashboard",icon:N.Z},{name:"Data Kendaraan",href:"/dashboard/vehicles",icon:k.Z},{name:"Riwayat Servis",href:"/dashboard/service-history",icon:z.Z},{name:"Rekap BBM&TOL",href:"/dashboard/rekap-bbm-tol",icon:C.Z},{name:"Laporan",href:"/dashboard/reports",icon:S.Z}];function L(e){let{children:t}=e,[a,o]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),h=(0,n.useRouter)(),f=(0,n.usePathname)(),{user:x,isAdmin:j}=(0,Z.a)(),N=async()=>{d(!0);try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Logout error:",e)}finally{h.push("/"),h.refresh()}},k=e=>{let{mobile:t=!1}=e;return(0,s.jsxs)("div",{className:"flex flex-col h-full ".concat("w-full"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 px-6 py-8",children:[(0,s.jsx)("div",{className:"relative w-12 h-12 flex items-center justify-center",children:(0,s.jsx)("img",{src:"/logo-bkn.png",alt:"Logo BKN",width:48,height:48,className:"object-contain drop-shadow-md"})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsxs)("h1",{className:"font-bold text-gray-900 text-lg leading-tight",children:["Pusbang",(0,s.jsx)("span",{className:"text-emerald-600",children:"SDM"})]}),(0,s.jsx)("p",{className:"text-[10px] text-gray-500 font-semibold uppercase tracking-wider",children:"Bagian Kendaraan"})]})]}),(0,s.jsxs)("nav",{className:"flex-1 px-4 py-4 space-y-2 overflow-y-auto custom-scrollbar",children:[(0,s.jsx)("p",{className:"px-4 text-xs font-bold text-gray-400 uppercase tracking-widest mb-2",children:"Menu Utama"}),A.map(e=>{let a=e.icon,r=f===e.href;return(0,s.jsx)("div",{children:(0,s.jsxs)(i.z,{variant:"ghost",className:"w-full justify-start gap-4 h-12 text-sm font-medium transition-all duration-300 rounded-2xl relative overflow-hidden ".concat(r?"text-white shadow-lg shadow-emerald-500/20":"text-gray-600 hover:text-emerald-700"),onClick:()=>{h.push(e.href),t&&o(!1)},children:[r&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-2xl"}),(0,s.jsxs)("div",{className:"relative z-10 flex items-center gap-4",children:[(0,s.jsx)(a,{className:"w-5 h-5 flex-shrink-0 ".concat(r?"text-white":"text-gray-400 group-hover:text-emerald-500")}),(0,s.jsx)("span",{className:"truncate",children:e.name})]})]})},e.name)})]})]})};return(0,s.jsxs)("div",{className:"min-h-screen relative overflow-hidden bg-slate-50",children:[(0,s.jsx)("div",{className:"fixed inset-0 overflow-hidden pointer-events-none -z-10",children:(0,s.jsx)("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-multiply"})}),(0,s.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-72 lg:flex-col p-4 z-50",children:(0,s.jsx)("div",{className:"flex flex-col flex-grow bg-white border border-gray-200/50 rounded-[2rem] shadow-xl shadow-gray-200/50 overflow-hidden",children:(0,s.jsx)(k,{})})}),(0,s.jsx)(c,{open:a,onOpenChange:o,children:(0,s.jsx)(m,{side:"left",className:"p-0 w-72 bg-transparent border-0 shadow-none",children:(0,s.jsx)("div",{className:"h-full w-full bg-white/90 backdrop-blur-3xl border-r border-white/40 p-4",children:(0,s.jsx)(k,{mobile:!0})})})}),(0,s.jsxs)("div",{className:"lg:pl-72 flex flex-col min-h-screen",children:[(0,s.jsx)("div",{className:"sticky top-4 z-40 px-4 lg:px-6 mb-2",children:(0,s.jsxs)("div",{className:"bg-white/80 backdrop-blur-xl border border-white/50 rounded-2xl shadow-sm px-4 py-3 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 sm:gap-4 min-w-0 flex-1",children:[(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{asChild:!0,children:(0,s.jsx)(i.z,{variant:"ghost",size:"sm",className:"lg:hidden p-2 hover:bg-white/50",children:(0,s.jsx)(_.Z,{className:"w-5 h-5"})})}),(0,s.jsx)(m,{side:"left",className:"p-0 w-72 bg-transparent border-0",children:(0,s.jsx)("div",{className:"h-full w-full bg-white/80 backdrop-blur-3xl border-r border-white/40 p-4",children:(0,s.jsx)(k,{mobile:!0})})})]}),(0,s.jsx)("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-slate-800 to-slate-600 truncate ml-2",children:(()=>{let e=A.find(e=>e.href===f);return(null==e?void 0:e.name)||"Dashboard"})()})]}),(0,s.jsxs)(g,{children:[(0,s.jsx)(p,{asChild:!0,children:(0,s.jsx)(i.z,{variant:"ghost",className:"relative h-10 w-10 rounded-full ring-2 ring-white/50 shadow-sm hover:ring-emerald-400/50 transition-all",children:(0,s.jsx)(w,{className:"h-10 w-10",children:(0,s.jsx)(y,{className:"bg-gradient-to-br from-emerald-500 to-teal-600 text-white font-bold",children:"A"})})})}),(0,s.jsxs)(v,{className:"w-56 bg-white/80 backdrop-blur-xl border-white/50 rounded-xl shadow-lg",align:"end",children:[(0,s.jsx)("div",{className:"flex items-center justify-start gap-3 p-3 bg-emerald-50/50 rounded-lg mb-1",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-0.5 leading-none",children:[(0,s.jsx)("p",{className:"font-bold text-gray-800",children:(null==x?void 0:x.name)||"User"}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:null==x?void 0:x.email}),j&&(0,s.jsx)("span",{className:"text-[10px] text-emerald-600 font-semibold uppercase",children:"Admin"})]})}),(0,s.jsxs)(b,{onSelect:N,disabled:l,className:"text-red-600 focus:bg-red-50 focus:text-red-700 cursor-pointer rounded-lg my-1",children:[(0,s.jsx)(E.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:l?"Keluar...":"Keluar"})]})]})]})]})}),(0,s.jsx)("main",{className:"flex-1 p-4 lg:p-6 pt-2",children:t})]})]})}},62869:function(e,t,a){a.d(t,{d:function(){return l},z:function(){return d}});var s=a(57437),r=a(2265),n=a(37053),i=a(90535),o=a(94508);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,s.jsx)(u,{"data-slot":"button",className:(0,o.cn)(l({variant:r,size:i,className:a})),ref:t,...c})});d.displayName="Button"},66070:function(e,t,a){a.d(t,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return n},aY:function(){return d},ll:function(){return o}});var s=a(57437);a(2265);var r=a(94508);function n(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...a})}function l(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...a})}},94508:function(e,t,a){a.d(t,{cn:function(){return n}});var s=a(61994),r=a(53335);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}}}]);